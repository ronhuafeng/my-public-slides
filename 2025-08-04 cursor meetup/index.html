<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自定义 MCP 工具加速软件开发</title>
    
    <link rel="stylesheet" href="./reveal.js/dist/reveal.css">
    <link rel="stylesheet" href="./reveal.js/dist/theme/white.css" id="theme">
    
    <!-- Theme used for syntax highlighting of code - using zenburn for now, will be overridden by custom CSS -->
    <link rel="stylesheet" href="./reveal.js/plugin/highlight/zenburn.css">
    
    <!-- Custom styles -->
    <link rel="stylesheet" href="css/custom.css">
</head>
<body>
        <div class="reveal">
        <div class="slides">
            <!-- Include all slide files -->
            <div data-external="slides/01-title.html"></div>
            <div data-external="slides/02-part1-mcp-basics.html"></div>
            <div data-external="slides/03-part2-design-principles.html"></div>
            <div data-external="slides/04-part3-development-practice.html"></div>
            <div data-external="slides/05-part4-ai-collaboration.html"></div>
            <div data-external="slides/06-part5-case-study.html"></div>
            <div data-external="slides/07-conclusion.html"></div>
        </div>
    </div>

    <script src="./reveal.js/dist/reveal.js"></script>
    <script src="./reveal.js/plugin/notes/notes.js"></script>
    <script src="./reveal.js/plugin/markdown/markdown.js"></script>
    <script src="./reveal.js/plugin/highlight/highlight.js"></script>
    <script src="./reveal.js/plugin/zoom/zoom.js"></script>
    <script src="./reveal.js/plugin/search/search.js"></script>

    <script>
        // Custom function to load external HTML slides
        async function loadExternalSlides() {
            const externalElements = document.querySelectorAll('[data-external]');
            
            for (const element of externalElements) {
                const src = element.getAttribute('data-external');
                try {
                    const response = await fetch(src);
                    const html = await response.text();
                    element.outerHTML = html;
                } catch (error) {
                    console.error(`Failed to load slide: ${src}`, error);
                    element.innerHTML = `<section><h2>Error</h2><p>Failed to load slide: ${src}</p></section>`;
                }
            }
        }

        // Load external slides first, then initialize Reveal.js
        loadExternalSlides().then(() => {
            Reveal.initialize({
                hash: true,
                controls: true,
                progress: true,
                center: true,
                transition: 'slide', // none/fade/slide/convex/concave/zoom
                
                // 16:9 aspect ratio
                width: 1920,
                height: 1080,
                
                // Learn about plugins: https://revealjs.com/plugins/
                plugins: [ 
                    RevealMarkdown, 
                    RevealHighlight, 
                    RevealNotes,
                    RevealZoom,
                    RevealSearch
                ]
            });

            // Initialize all draw.io diagrams when reveal.js is ready
            Reveal.addEventListener('ready', function() {
                initializeAllDrawioDiagrams();
            });

            // Also initialize when navigating to slides with diagrams
            Reveal.addEventListener('slidechanged', function(event) {
                initializeDrawioDiagramsInSlide(event.currentSlide);

                // Render Flow Chart if the slide contains the chart container
                const flowChartContainer = event.currentSlide.querySelector('#flow-chart');
                if (flowChartContainer) {
                    FlowChartApp.renderFlowChart(flowChartContainer);
                }
            });
        });

        function initializeAllDrawioDiagrams() {
            const containers = document.querySelectorAll('[data-drawio-src]');
            containers.forEach(container => initializeDrawioDiagram(container));
        }

        function initializeDrawioDiagramsInSlide(slide) {
            const containers = slide.querySelectorAll('[data-drawio-src]');
            containers.forEach(container => initializeDrawioDiagram(container));
        }

        function initializeDrawioDiagram(container) {
            if (!container || container.hasChildNodes()) {
                return; // Already initialized or container not found
            }

            const xmlFile = container.getAttribute('data-drawio-src');
            if (!xmlFile) {
                container.innerHTML = '<p style="color: #ff6b6b; text-align: center; padding: 20px;">Error: Missing data-drawio-src attribute</p>';
                return;
            }

            // Fetch and render the draw.io XML
            fetch(xmlFile)
                .then(response => response.text())
                .then(data => {
                    try {
                        // Parse the XML directly
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(data, 'application/xml');
                        
                        // Check for parsing errors
                        const parserError = doc.querySelector('parsererror');
                        if (parserError) {
                            throw new Error('XML parsing failed: ' + parserError.textContent);
                        }
                        
                        // Create the GraphViewer with online viewer
                        const viewer = new GraphViewer(
                            container,
                            doc.documentElement,
                            {
                                nav: true,
                                toolbar: 'zoom layers lightbox',
                                resizeContainer: true
                            }
                        );

                    } catch (error) {
                        console.error('Error rendering draw.io diagram:', error);
                        container.innerHTML = '<p style="color: #ff6b6b; text-align: center; padding: 20px;">Error loading diagram: ' + error.message + '</p>';
                    }
                })
                .catch(error => {
                    console.error('Error fetching draw.io XML:', error);
                    container.innerHTML = '<p style="color: #ff6b6b; text-align: center; padding: 20px;">Error loading diagram file: ' + error.message + '</p>';
                });
        }
    </script>
</body>
</html>
