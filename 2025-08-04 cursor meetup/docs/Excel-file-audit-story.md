### 实战案例：构建反馈循环，利用大模型自动进行算法优化

#### 场景背景：Excel 文件批量验证

模块任务：给定一组验证规则，使用一个 agentic workflow 去验证每个 Excel 文件是否满足这些规则，并给判断的依据。

规则举例：

- 标注为“数量”的列不为空
- 表格中 “完成”需要 打勾 ☑

这个任务涉及到 Excel 文件的读取和分析。可以使用正则表达式提取、大模型判断或者一些复合手段来给出最后的判断。

- 正则匹配 完成，然后在前后匹配 ☑ 或者类似的字符
- 将 Excel 转成文本，加上提示词，让大模型去判断

现实的问题：

- Excel 文件排版不一致，导致定位特定的列的算法并不稳定
- 文件中一个 sheet 可能有多个“区域”，即一个 sheet 其实放下了多个 sheet 的内容，区域划分是通过带有颜色的单元格合并后模拟的边界。因此判断一列的结束需要一些技巧。

#### 基于 MCP 的解决方案架构

**核心思路**：构建一个自我优化的反馈循环系统

```
测试驱动的迭代优化流程：
输入：算法原型 + 验证规则 + 测试文件集 + 预期结果
│
├─→ 执行检测算法 → 获得实际输出
├─→ 对比预期结果 → 识别差异点
├─→ 分析失败原因 → 生成改进建议
└─→ 更新算法实现 → 重新测试验证
```

**具体实施步骤**：

1. **建立测试基础设施**
   - 构建包含多种典型场景的 Excel 文件测试集
   - 定义每个文件的标准验证结果
   - 创建可自动化执行的测试脚本

2. **启动 AI 驱动的优化循环**
   - 使用 GitHub Copilot 执行：`<检查算法, 规则描述, 测试文件>` → 获得初始输出
   - 根据 `<算法描述, 预期结果, 实际差异>` 生成算法改进方案
   - 应用改进后的算法重新测试，持续迭代直至达标

#### 优化过程中的关键发现

**遇到的典型陷阱**：
- ❌ **过度拟合**：算法根据文件名特征进行判断，缺乏泛化能力
- ❌ **关键词堆砌**：使用大量硬编码关键词匹配，算法脆弱且不通用
- ❌ **忽视边界情况**：只针对理想格式优化，忽视现实中的格式变异

**获得的意外收获**：
- ✅ **Excel 处理组件库**：沉淀出高质量的 Excel 文件处理代码片段
  - 智能提取 sheet 名称和结构
  - 理解和处理合并单元格逻辑
  - 解析单元格颜色和样式信息
- ✅ **领域知识积累**：将 Excel 文件处理的经验知识结构化，为后续类似项目提供参考

#### 成功的关键因素

**领域知识注入**：将人类专家对 Excel 文件格式的理解整理成结构化知识，作为上下文提供给 AI，显著提升算法生成质量。

**渐进式优化**：从最简单的规则开始，逐步增加复杂性，确保每一步都有稳定的基础。

**自动化反馈**：建立完整的测试-反馈-优化闭环，让 AI 能够从错误中快速学习和改进。

---

💡 **参考资料**：Google DeepMind《AlphaEvolve: A Gemini-powered coding agent for designing advanced algorithms》
